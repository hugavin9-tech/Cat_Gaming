<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“ç½‘é¡µç¯®çƒ - æ‹–æ‹½æŠ•ç¯®</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        canvas {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA); /* å¤©ç©ºèƒŒæ™¯ */
            border: 4px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border-radius: 4px;
            cursor: crosshair;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #333;
            pointer-events: none; /* è®©é¼ æ ‡ç©¿é€UIç›´æ¥æ“ä½œCanvas */
        }
        h1 {
            margin: 0;
            font-size: 24px;
            color: #d35400;
            text-shadow: 1px 1px 0px white;
        }
        #score-board {
            font-size: 40px;
            font-weight: bold;
            color: #e74c3c;
            text-shadow: 2px 2px 0px white;
        }
        .instructions {
            margin-top: 5px;
            font-size: 14px;
            color: #555;
            background: rgba(255,255,255,0.7);
            padding: 5px 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h1>ğŸ€ è¡—å¤´æŠ•ç¯®ç‹</h1>
        <div id="score-board">å¾—åˆ†: 0</div>
        <div class="instructions">é¼ æ ‡æŒ‰ä½çƒ -> å‘åæ‹–æ‹½è“„åŠ› -> æ¾å¼€æŠ•ç¯®<br>æŒ‰ R é”®é‡ç½®çƒçš„ä½ç½®</div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-board');

    // --- æ¸¸æˆå˜é‡ ---
    let score = 0;
    
    // ç‰©ç†å‚æ•°
    const gravity = 0.5;
    const friction = 0.99; // ç©ºæ°”é˜»åŠ›
    const bounce = 0.7; // å¼¹åŠ›ç³»æ•° (0-1)

    // ç¯®çƒå¯¹è±¡
    const ball = {
        x: 100,
        y: 450,
        radius: 18,
        vx: 0,
        vy: 0,
        isDragging: false,
        isInAir: false,
        dragStartX: 0,
        dragStartY: 0
    };

    // ç¯®ç­å¯¹è±¡
    const hoop = {
        x: 650,
        y: 250,
        width: 60,  // ç¯®ç­ç›´å¾„
        height: 5,
        backboardX: 710,
        backboardY: 180,
        backboardH: 80,
        backboardW: 10
    };

    // --- è¾“å…¥äº‹ä»¶ç›‘å¬ ---

    canvas.addEventListener('mousedown', (e) => {
        if (ball.isInAir) return; // çƒåœ¨ç©ºä¸­ä¸èƒ½æ§åˆ¶

        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        // æ£€æµ‹ç‚¹å‡»æ˜¯å¦åœ¨çƒä¸Š
        const dist = Math.hypot(mouseX - ball.x, mouseY - ball.y);
        if (dist < ball.radius * 2) {
            ball.isDragging = true;
            ball.dragStartX = mouseX;
            ball.dragStartY = mouseY;
        }
    });

    canvas.addEventListener('mousemove', (e) => {
        if (ball.isDragging) {
            const rect = canvas.getBoundingClientRect();
            ball.dragStartX = e.clientX - rect.left;
            ball.dragStartY = e.clientY - rect.top;
        }
    });

    window.addEventListener('mouseup', () => {
        if (ball.isDragging) {
            ball.isDragging = false;
            ball.isInAir = true;
            
            // è®¡ç®—å‘å°„åŠ›åº¦ (åå‘)
            const power = 0.15;
            ball.vx = (ball.x - ball.dragStartX) * power;
            ball.vy = (ball.y - ball.dragStartY) * power;
        }
    });

    // æŒ‰Ré‡ç½®
    window.addEventListener('keydown', (e) => {
        if (e.key === 'r' || e.key === 'R') {
            resetBall();
        }
    });

    function resetBall() {
        ball.x = 100 + Math.random() * 50; //ç¨å¾®éšæœºä¸€ç‚¹ä½ç½®
        ball.y = 450;
        ball.vx = 0;
        ball.vy = 0;
        ball.isInAir = false;
        ball.isDragging = false;
    }

    // --- æ ¸å¿ƒé€»è¾‘ ---

    function update() {
        // 1. åº”ç”¨ç‰©ç†
        if (ball.isInAir) {
            ball.vy += gravity;
            ball.vx *= friction;
            ball.vy *= friction;

            ball.x += ball.vx;
            ball.y += ball.vy;

            // åœ°æ¿ç¢°æ’
            if (ball.y + ball.radius > canvas.height - 50) { // 50æ˜¯åœ°æ¿é«˜åº¦
                ball.y = canvas.height - 50 - ball.radius;
                ball.vy *= -bounce;
                
                // å¦‚æœé€Ÿåº¦å¾ˆæ…¢äº†ï¼Œå°±åœæ­¢
                if (Math.abs(ball.vy) < gravity * 2) {
                    ball.isInAir = false;
                    setTimeout(resetBall, 1000); // 1ç§’åé‡ç½®
                }
            }

            // å¢™å£ç¢°æ’
            if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {
                ball.vx *= -bounce;
                // é˜²æ­¢çƒå¡å‡ºå¢™å¤–
                if(ball.x + ball.radius > canvas.width) ball.x = canvas.width - ball.radius;
                if(ball.x - ball.radius < 0) ball.x = ball.radius;
            }

            // ç¯®æ¿ç¢°æ’ (ç®€åŒ–ç‰ˆçŸ©å½¢ç¢°æ’)
            if (ball.x + ball.radius > hoop.backboardX && 
                ball.x - ball.radius < hoop.backboardX + hoop.backboardW &&
                ball.y > hoop.backboardY && 
                ball.y < hoop.backboardY + hoop.backboardH) {
                    ball.vx *= -1; // ç®€å•çš„åå¼¹
                    ball.x = hoop.backboardX - ball.radius - 1;
            }

            // è¿›çƒæ£€æµ‹
            // é€»è¾‘ï¼šçƒå¿ƒå¿…é¡»åœ¨ç¯®ç­XèŒƒå›´å†…ï¼Œä¸”çƒä»ä¸Šå¾€ä¸‹ç©¿è¿‡ç¯®ç­Yåæ ‡
            if (ball.vy > 0 && // å¿…é¡»å‘ä¸‹è½
                ball.x > hoop.x && 
                ball.x < hoop.x + hoop.width &&
                ball.y + ball.radius >= hoop.y && 
                ball.y - ball.radius <= hoop.y + 10) {
                    
                    // ç®€å•çš„å¾—åˆ†åˆ¤å®šï¼Œé˜²æ­¢ä¸€å¸§å†…è§¦å‘å¤šæ¬¡
                    if (!ball.hasScoredThisShot) {
                        score++;
                        scoreEl.innerText = "å¾—åˆ†: " + score;
                        ball.hasScoredThisShot = true; 
                        // è¿›çƒç‰¹æ•ˆæç¤º
                        showToast();
                    }
            }
        } else {
            ball.hasScoredThisShot = false; // é‡ç½®è¿›çƒçŠ¶æ€
        }
    }

    function draw() {
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶åœ°æ¿
        ctx.fillStyle = "#D2691E";
        ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, canvas.height - 50);
        ctx.lineTo(canvas.width, canvas.height - 50);
        ctx.stroke();

        // ç»˜åˆ¶ç¯®æ¶æ”¯æŸ±
        ctx.fillStyle = "#555";
        ctx.fillRect(hoop.backboardX + 5, hoop.backboardY + 50, 10, canvas.height - hoop.backboardY);

        // ç»˜åˆ¶ç¯®æ¿
        ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
        ctx.fillRect(hoop.backboardX, hoop.backboardY, hoop.backboardW, hoop.backboardH);
        ctx.strokeStyle = "red";
        ctx.strokeRect(hoop.backboardX, hoop.backboardY + 45, hoop.backboardW, 30);

        // ç»˜åˆ¶ç¯®ç­ (Rim)
        ctx.beginPath();
        ctx.moveTo(hoop.backboardX, hoop.y);
        ctx.lineTo(hoop.x, hoop.y);
        ctx.strokeStyle = "orange";
        ctx.lineWidth = 5;
        ctx.stroke();

        // ç»˜åˆ¶ç„å‡†çº¿ (å¦‚æœåœ¨æ‹–æ‹½ä¸­)
        if (ball.isDragging) {
            ctx.beginPath();
            ctx.moveTo(ball.x, ball.y);
            ctx.lineTo(ball.dragStartX, ball.dragStartY);
            ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.setLineDash([]); // é‡ç½®è™šçº¿
        }

        // ç»˜åˆ¶ç¯®çƒ
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "#e67e22";
        ctx.fill();
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // ç¯®çƒçº¹ç† (ç®€å•çš„åå­—çº¿æ¨¡æ‹Ÿæ—‹è½¬è§†è§‰)
        ctx.beginPath();
        ctx.moveTo(ball.x - ball.radius, ball.y);
        ctx.lineTo(ball.x + ball.radius, ball.y);
        ctx.moveTo(ball.x, ball.y - ball.radius);
        ctx.lineTo(ball.x, ball.y + ball.radius);
        ctx.strokeStyle = "rgba(0,0,0,0.3)";
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    // æ¸¸æˆå¾ªç¯
    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    // è¿›çƒæç¤º
    function showToast() {
        const toast = document.createElement('div');
        toast.innerText = "ç©ºå¿ƒå…¥ç½‘! ğŸ”¥";
        toast.style.position = 'absolute';
        toast.style.top = '40%';
        toast.style.left = '50%';
        toast.style.transform = 'translate(-50%, -50%)';
        toast.style.fontSize = '50px';
        toast.style.color = '#f1c40f';
        toast.style.fontWeight = 'bold';
        toast.style.textShadow = '2px 2px 4px black';
        toast.style.transition = 'opacity 1s';
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 1000);
        }, 500);
    }

    // å¯åŠ¨
    loop();

</script>
</body>
</html>